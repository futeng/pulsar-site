---
id: concepts-messaging
title: 消息传递
sidebar_label: "消息传递"
description: 全面理解 Pulsar 中的基本消息概念，包括主题、命名空间、订阅等。
---

````mdx-code-block
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
````


Pulsar 基于[发布-订阅](https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern)模式（通常简称为 pub-sub）构建。在这种模式中，[生产者](concepts-clients.md#producer)向[主题](#topics)发布消息；[消费者](concepts-clients.md#consumer)[订阅](#subscriptions)这些主题，处理传入的消息，并在处理完成时向代理发送[确认](#acknowledgment)。

![Pulsar 中的发布-订阅模式](/assets/pub-sub-border.svg)

当创建订阅时，Pulsar 会[保留](concepts-architecture-overview.md#persistent-storage)所有消息，即使消费者处于断开连接状态。只有当消费者确认所有这些消息都已成功处理时，保留的消息才会被丢弃。

如果消息消费失败，并且您希望重新消费此消息，可以启用[消息重新投递机制](#message-redelivery)来请求代理重新发送此消息。

## 消息

消息是 Pulsar 的基本"单元"。它们是生产者发布到主题、消费者从主题消费的内容。下表列出了消息的组成部分。

| 组件            | 描述                                                                                                                                                                                                                                                                                                                                                                                                                 |
|:----------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 值 / 数据负载   | 消息携带的数据。所有 Pulsar 消息都包含原始字节，尽管消息数据也可以符合数据[模式](schema-get-started.md)。                                                                                                                                                                                                                                                                                                           |
| 键              | 消息的键（字符串类型）。它是消息键或分区键的简称。消息可以选择性地标记键，这对于像[主题压缩](concepts-topic-compaction.md)这样的功能很有用。                                                                                                                                                                                                                                                              |
| 属性            | 可选的用户定义属性的键/值映射。                                                                                                                                                                                                                                                                                                                                                                                      |
| 生产者名称      | 生成消息的生产者的名称。如果未指定生产者名称，则使用默认名称。                                                                                                                                                                                                                                                                                                                                                       |
| 主题名称        | 消息发布到的主题名称。                                                                                                                                                                                                                                                                                                                                                                                               |
| 模式版本        | 生成消息时使用的模式版本号。                                                                                                                                                                                                                                                                                                                                                                                         |
| 序列 ID         | 每个 Pulsar 消息属于其主题上的有序序列。消息的序列 ID 最初由其生产者分配，指示其在该序列中的顺序，也可以自定义。<br />序列 ID 可用于消息去重。如果 `brokerDeduplicationEnabled` 设置为 `true`，则每个消息的序列 ID 在主题（非分区）的生产者或分区内是唯一的。                                                                                     |
| 消息 ID         | 消息的消息 ID 在消息持久存储后立即由 bookies 分配。消息 ID 指示消息在账本中的特定位置，在 Pulsar 集群内是唯一的。                                                                                                                                                                                                                                     |
| 发布时间        | 消息发布时的时间戳。时间戳由生产者自动应用。                                                                                                                                                                                                                                                                                                                                                                         |
| 事件时间        | 由应用程序附加到消息的可选时间戳。例如，应用程序在处理消息时附加时间戳。如果未设置事件时间，则值为 `0`。                                                                                                                                                                                                                                              |

消息的默认最大大小为 5 MB。您可以使用以下配置选项配置消息的最大大小。

- 在 `broker.conf` 文件中。

  ```bash
  # 消息的最大大小（以字节为单位）。
  maxMessageSize=5242880
  ```

- 在 `bookkeeper.conf` 文件中。

  ```bash