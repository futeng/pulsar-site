---
author: Matteo Merli
title: "Log4j2 零日漏洞 (CVE-2021-44228)"
---

昨天，报告了一个关于 Log4j 的新严重漏洞，可能允许攻击者远程执行代码。

<!--truncate-->

该漏洞问题在 [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228) 中进行了描述和跟踪。

当前版本的 Apache Pulsar 绑定了受此漏洞影响的 Log4j2 版本。
默认配置结合 JVM 版本和其他因素可能使其可被利用。
我们强烈建议遵循 Apache Log4j 社区的建议并尽快修补您的系统，
同时查看 Pulsar 日志中的异常行为。

有两种变通方法可以修补 Pulsar 部署。您可以设置以下任一选项：

 1. Java 属性：`-Dlog4j2.formatMsgNoLookups=true`
 2. 环境变量：`LOG4J_FORMAT_MSG_NO_LOOKUPS=true`

这两种方法都能有效缓解 Pulsar 服务的漏洞。

此外，在使用 Kubernetes 运行时运行 Pulsar Functions 时，您应该更新
Docker 镜像，按照[此处](https://github.com/lhotari/pulsar-docker-images-patch-CVE-2021-44228)描述的示例操作。

如果您使用 Pulsar Helm Chart 在 Kubernetes 中部署，图表的[新版本](https://github.com/apache/pulsar-helm-chart/releases/tag/pulsar-2.7.6)已经可用，它应用了上述变通方法。
如果无法升级，您也可以通过在 helm values 文件的 `configData` 部分中为 proxy、broker、bookkeeper、zookeeper、auto-recovery 和相关组件的 `PULSAR_EXTRA_OPTS` 添加 `-Dlog4j2.formatMsgNoLookups=true` 来缓解问题。

我们已经在准备新的补丁版本 2.7.4、2.8.2 和 2.9.1。这些版本将在未来几天内准备就绪，并将捆绑包含漏洞修复的 Log4j2 2.15.0。