---
id: transactions
title: 事务
sidebar_label: "概述"
---

事务语义使事件流应用程序能够在一个原子操作中消费、处理和生产消息。在 Pulsar 中，生产者或消费者可以跨多个主题和分区处理消息，并确保这些消息作为单个单元处理。

以下概念帮助你理解 Pulsar 事务。

## 事务协调器和事务日志
事务协调器维护在事务中交互的主题和订阅。当事务提交时，事务协调器与主题所有者 broker 交互以完成事务。

事务协调器维护事务的整个生命周期，防止事务处于不正确状态。

事务协调器处理事务超时，并确保在事务超时后事务中止。

所有事务元数据都持久保存在事务日志中。事务日志由 Pulsar 主题支持。事务协调器崩溃后，它可以从事务日志恢复事务元数据。

## 事务 ID
事务 ID（TxnID）标识 Pulsar 中的唯一事务。事务 ID 为 128 位。最高 16 位保留给事务协调器的 ID，剩余位用于每个事务协调器中的单调递增数字。使用 TxnID 可以轻松定位事务崩溃。

## 事务缓冲区
在事务内产生的消息存储在事务缓冲区中。事务缓冲区中的消息在事务提交之前不会物化（可见）给消费者。事务缓冲区中的消息在事务中止时被丢弃。

## 待确认状态
事务内的消息确认在事务完成之前由待确认状态维护。如果消息处于待确认状态，则在消息从待确认状态移除之前，其他事务无法确认该消息。

待确认状态持久保存在待确认日志中。待确认日志由 Pulsar 主题支持。新的 broker 可以从待确认日志恢复状态，以确保确认不会丢失。