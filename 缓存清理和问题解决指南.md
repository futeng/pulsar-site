# Docusaurus 缓存清理和问题解决指南

## 🔧 问题诊断

### 遇到的错误
```
Module not found: Error: Can't resolve '@site/i18n/zh-cn/docusaurus-plugin-content-docs/current/getting-started-home.md'
```

### 错误原因
1. **Docusaurus 缓存问题**: 当添加新的翻译文件时，Docusaurus可能缓存了旧的文件结构
2. **构建缓存**: Webpack缓存可能包含过时的模块解析信息
3. **热重载失效**: 新添加的文件可能没有被正确识别

## ✅ 解决方案

### Step 1: 停止开发服务器
```bash
# 方法1: 如果在后台运行
pkill -f "docusaurus start"

# 方法2: 使用 Ctrl+C 停止前台进程
# 方法3: 使用 KillShell 工具（如果在Claude Code中）
```

### Step 2: 清理缓存
```bash
# 清理 Docusaurus 缓存
rm -rf .docusaurus

# 清理构建目录
rm -rf build

# 清理 node_modules 缓存
rm -rf node_modules/.cache

# 可选：清理更彻底的缓存
rm -rf node_modules/.cache/webpack
```

### Step 3: 验证文件结构
```bash
# 确认翻译文件在正确位置
ls -la i18n/zh-cn/docusaurus-plugin-content-docs/current/getting-started-home.md

# 检查文件权限
ls -la i18n/zh-cn/docusaurus-plugin-content-docs/current/

# 确认文件内容正确
cat i18n/zh-cn/docusaurus-plugin-content-docs/current/getting-started-home.md
```

### Step 4: 重新启动开发服务器
```bash
# 重新启动
npm run start

# 或者使用 yarn
yarn start
```

### Step 5: 验证修复
```bash
# 检查页面是否可访问
curl -s -o /dev/null -w "%{http_code}" http://localhost:3000/zh-cn/docs/getting-started-home

# 应该返回 200
```

## 🎯 预防措施

### 在添加新翻译文件时的最佳实践

#### 1. 按正确步骤添加文件
```bash
# 1. 确保目录存在
mkdir -p i18n/zh-cn/docusaurus-plugin-content-docs/current/

# 2. 创建文件
touch i18n/zh-cn/docusaurus-plugin-content-docs/current/new-file.md

# 3. 编辑文件内容
# ... 编辑文件 ...

# 4. 如果遇到问题，清理缓存
rm -rf .docusaurus

# 5. 重启开发服务器
npm run start
```

#### 2. 检查 Docusaurus 配置
确保 `docusaurus.config.js` 中的 i18n 配置正确：
```javascript
module.exports = {
  i18n: {
    defaultLocale: 'en',
    locales: ['zh-cn'],
    localeConfigs: {
      'zh-cn': {
        label: '中文',
        direction: 'ltr',
      },
    },
  },
  // ...
};
```

#### 3. 验证文件命名约定
- 翻译文件必须与原始文件同名
- 必须放在正确的目录结构中
- 使用正确的文件扩展名 (`.md`)

## 🛠️ 故障排除工具

### 自动化清理脚本
```bash
#!/bin/bash
# clean-pulsar-cache.sh

echo "🧹 清理 Pulsar 网站缓存..."

# 停止开发服务器
pkill -f "docusaurus start" 2>/dev/null || true

# 清理缓存
rm -rf .docusaurus
rm -rf build
rm -rf node_modules/.cache

echo "✅ 缓存清理完成"

# 重新启动
echo "🚀 重新启动开发服务器..."
npm run start
```

### 文件结构检查脚本
```bash
#!/bin/bash
# check-translation-structure.sh

echo "🔍 检查翻译文件结构..."

# 检查目录是否存在
if [ ! -d "i18n/zh-cn/docusaurus-plugin-content-docs/current" ]; then
    echo "❌ 翻译目录不存在"
    exit 1
fi

# 检查特定文件
if [ -f "i18n/zh-cn/docusaurus-plugin-content-docs/current/getting-started-home.md" ]; then
    echo "✅ getting-started-home.md 翻译文件存在"
else
    echo "❌ getting-started-home.md 翻译文件不存在"
fi

# 列出所有翻译文件
echo "📁 现有翻译文件："
ls -la i18n/zh-cn/docusaurus-plugin-content-docs/current/
```

## 📊 常见问题及解决方案

| 问题 | 原因 | 解决方案 |
|------|------|----------|
| `Module not found` | 缓存问题 | 清理 `.docusaurus` 和 `build` 目录 |
| 页面404 | 文件路径错误 | 检查文件命名和目录结构 |
| 翻译不显示 | i18n配置问题 | 检查 `docusaurus.config.js` 配置 |
| 构建失败 | 语法错误 | 检查 Markdown 格式和 frontmatter |
| 热重载失效 | 缓存问题 | 重启开发服务器 |

## 🎉 成功验证

### 验证清单
- [ ] 开发服务器启动无错误
- [ ] 翻译页面返回200状态码
- [ ] 页面内容正确显示中文
- [ ] 侧边栏导航正确显示
- [ ] 链接跳转正常工作

### 测试命令
```bash
# 1. 检查服务器状态
curl http://localhost:3000/health

# 2. 检查页面可访问性
curl -I http://localhost:3000/zh-cn/docs/getting-started-home

# 3. 检查页面内容
curl http://localhost:3000/zh-cn/docs/getting-started-home | grep "快速入门"
```

## 💡 经验总结

1. **缓存是常见问题**: Docusaurus的缓存机制很强大，但有时会导致新文件不被识别
2. **清理要彻底**: 不仅要清理 `.docusaurus`，还要清理 `build` 和 `node_modules/.cache`
3. **重启很重要**: 清理缓存后必须完全重启开发服务器
4. **验证要及时**: 每次添加新翻译文件后都要验证页面是否正常访问

这次问题的完美解决为后续的大规模翻译工作提供了宝贵的经验！